<!DOCTYPE html>
<html>
   <meta charset="UTF-8">
   <title>changeme title</title>
<!--
 Q:Note what the attribute { and } do:
 A:Those attributes are ignored by the browser but are helpful to fold/unfold text in some
   editors (Vim, Emacs,...)
-->
<!--
ROW TEMPLATE
<tr {>
  <td col1 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col2 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col3 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
</tr }>
-->

<head>
<script>
var zoomDivDOM
function onZoomDivDoubleClick() { zoomDivDOM.innerHTML = ''; }
var zoomDivFW = true; // FW Full Width
var zoomDivFH = true; // FW Full Height 
var zoomDivTop = true; 
var zoomDivLft = true; 
function onTDDoubleClick()      { zoomDivDOM.innerHTML = 
     "('Esc' to close) Toggle "+
     "<span style='color:blue;' onClick=\"zoomDivFW  = !zoomDivFW ; zoomDivDOM.style.maxWidth  = zoomDivFW  ? '98%' : '30%'\">[Width]</span> " 
   + "<span style='color:blue;' onClick=\"zoomDivFH  = !zoomDivFH ; zoomDivDOM.style.maxHeight = zoomDivFH  ? '98%' : '30%'\">[Height]</span> " 
   + " Toggle " 
   + "<span style='color:blue;' onClick=\"zoomDivLft = !zoomDivLft; zoomDivDOM.style.left      = zoomDivLft ? '1%'  : '69%'\">[Horz]</span> " 
   + "<span style='color:blue;' onClick=\"zoomDivTop = !zoomDivTop; zoomDivDOM.style.top       = zoomDivTop ? '1%'  : '69%'\">[Vert]</span> " 
   + " <br/> " 
   + this.innerHTML; 
}

function removeToLeftMarginInPre() {
  // TODO:(0) Not working
  // nodeList = document.querySelectorAll('pre')
  // for (idx in nodeList) { 
  //   var node = nodeList[idx]
  //   var html = node.innerHTML
  //   var pattern = html.match(/^\s*[|]/)
  //   var regEx = new RegExp(pattern, "")
  //   console.log(html)
  //   node.innerHTML = html.replace(regEx,''))
  //    
  // }
}


function onPageLoaded() {
  zoomDivDOM = document.getElementById('zoomDiv')
  document.addEventListener('keyup',function(e) { if (e.code !== "Escape") return; onZoomDivDoubleClick(); })
  // Change default a.target to blank. Ussually this is bad practice 
  // but this is the exception to the rule
  var nodeList = document.querySelectorAll('a')
  for (idx in nodeList) { 
      if (!nodeList[idx].href) { continue; }
      if (nodeList[idx].href && !nodeList[idx].href.startsWith("http")) continue;
      nodeList[idx].target='_blank'; 
  }
  nodeList = document.querySelectorAll('td')
  for (idx in nodeList) { 
     if (!!! nodeList[idx].addEventListener) continue;
     nodeList[idx].addEventListener('dblclick',onTDDoubleClick, false)
  }
  setTimeout(onZoomDivDoubleClick, 3000);
  removeToLeftMarginInPre();
}
</script>
<style { >
*[mono]         { font-family: monospace; white-space: pre; }
pre { background-color:#EEEEEE; outline:1px dotted grey; margin: 0; }
*[cite]         { font-style: italic; }
*[TODO]         { color:red; font-weight: bold; }
*[TODO]:before  { content: "TODO:"; }
*[xxxsmall]{ font-size:0.1rem; }
img[xxxsmall]{ max-width:10rem; }
* xxsmall] { font-size:0.3rem; }
*[xsmall]  { font-size:0.7rem; }
*[small]   { font-size:0.9rem; }
*[xxbig]  { font-size:1.7em; font-weight: bold; color:#007733;}
*[xbig]  { font-size:1.5em; }
ul,ol { margin-left: 1.0em; padding-left: 0rem; }
#zoomDiv [xxxsmall] , #zoomDiv * [xxxsmall], #zoomDiv * * [xxxsmall], #zoomDiv * * * [xxxsmall]{ font-size:1em; } 
#zoomDiv img[xxxsmall] , #zoomDiv * img[xxxsmall], #zoomDiv * * img[xxxsmall], #zoomDiv * * * img[xxxsmall]{ max-width:100%; } 

/* REF: https://stackoverflow.com/questions/4910077/select-all-child-elements-recursively-in-css */
#zoomDiv * [small], #zoomDiv * [xsmall], #zoomDiv * [xxsmall] { font-size:1em; }
#zoomDiv *[small], #zoomDiv *[xsmall], #zoomDiv *[xxsmall] { font-size:1em; }
#zoomDiv * td { font-size:1em; }

body      { font-family:sans-serif; font-size:16px; padding: 0; margin: 0; }
#zoomDiv  { 
   position:fixed; top:1%; left:1%; width:auto; height:auto;
   max-height: 98%; max-width: 98%; overflow: auto;
   background-color:#FFFFFF; color:#000; border-radius: 0.5rem; border: 4px solid black; font-size: 2rem;
   box-shadow: 5px 5px 30px black;
   padding: 0.5rem;
}

a            { text-decoration:none; font-family:monospace; padding:0.1em;}
a[href^="#"]:before /* mark internal anchor */ {  content: ">"; }
a[href^="#"]:after  /* mark internal anchor */ {  content: "<"; }
a:visited { color:blue; }
td { 
   font-size: 0.8rem;
   vertical-align: top;
   outline: 1px solid grey; 
}
td[col1] ,th[col1] {background-color:#FFFFFF; min-width:34%; max-width:34%; }
td[col2] ,th[col2] {background-color:#FAFAFA; min-width:33%; max-width:33%; }
td[col3] ,th[col3] {background-color:#FFFFFF; min-width:33%; max-width:33%; }
tr[header_delimit] > *{background-color:#000000; color:#FFFFFF; font-size:2em; color: white; }
tr[header_delimit] > td > a{color:inherit; text-decoration: underline; }
div[subtable1] { max-width: 95%; overflow: auto; padding:0; margin: 0;}

</style }>
</head>
<body onLoad='onPageLoaded()'>
<div id='zoomDiv'>Hint: double-click on cell to zoom!!</div>

<table style='width:100%'{>
<tbody>
<tr {>
  <th colspan=3 header_delimit {   >topic1</th>
</tr }>
<tr {>
  <td col1 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col2 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col3 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
</tr }>
<tr {>
  <th colspan=3 header_delimit } { >topic2</th>
</tr }>
<tr {>
  <td col1 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col2 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col3 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
</tr }>
<tr {>
  <th colspan=3 header_delimit }   >topic3</th>
</tr }>
<tr {>
  <td col1 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col2 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
  <td col3 >
     <ul>
       <li> </li>
       <li> </li>
       <li> </li>
     </ul>
  </td>  
</tr }>
</body>
<!--
REF: http://www.alanflavell.org.uk/unicode/unidata25.html
─  ┐  ┠   ┰    ╀   ═   ╠   ╰     ┌─────┬─────┐
                                 │     │     │
━  ┑  ┡   ┱    ╁   ║   ╡   ╱     │     │     │
                                 ├─────┼─────┤
│  ┒  ┢   ┲    ╂   ╒   ╢   ╲     │     │     │
                                 │     │     │
┃  ┓  ┣   ┳    ╃   ╓   ╣   ╳     └─────┴─────┘
                                 ← ↑
┄  └  ┤   ┴    ╄   ╔   ╤   ╴     → ↓

┅  ┕  ┥   ┵    ╅   ╕   ╥   ╵     ┌─────────┐
                                 │         │
┆  ┖  ┦   ┶    ╆   ╖   ╦   ╶     │         │
                                 │         │
┇  ┗  ┧   ┷    ╇   ╗   ╧   ╷     │         │
                                 └─────────┘
┈  ┘  ┨   ┸    ╈   ╘   ╨   ╸ 

┉  ┙  ┩   ┹    ╉   ╙   ╩   ╹ 

┊  ┚  ┪   ┺    ╊   ╚   ╪   ╺ 

┋  ┛  ┫   ┻    ╋   ╛   ╫   ╻ 

┌  ├  ┬   ┼    ╌   ╜   ╬   ╼ 

┍  ┝  ┭   ┽    ╍   ╝   ╭   ╽ 

┎  ┞  ┮   ┾    ╎   ╞   ╮   ╾ 

┏  ┟  ┯   ┿    ╏   ╟   ╯   ╿ 

-->

<!--
4.2. operating system tuning
NODE JS ARCHITECTURE I 4. Software solution
4096 bytes per socket.
TCP RECYCLE ( REUSE TIMEWAIT STATE)
echo 1 > /proc/sys/net/ipv4/tcp_tw_recycle (0 default value)
root@ubuntu:~# cat /etc/security/limits.conf
...
ubuntu soft nofile 1000000
ubuntu hard nofile 1000000
ubuntu soft nproc 200000
ubuntu hard nproc 200000
root@ubuntu:~# cat /etc/sysctl.conf
...
fs.file-max = 6815744
net.core.rmem_max = 25165824
# Maximum TCP Send Window
net.core.wmem_max = 25165824
# others
net.ipv4.tcp_rmem = 4096 16384 25165824
net.ipv4.tcp_wmem = 4096 16384 25165824
net.ipv4.tcp_syncookies = 1
# this gives the kernel more memory for tcp which you need with many (100k+) open socket connections
# 786432 = 3GB
net.ipv4.tcp_mem = 786432 1048576 26777216
net.ipv4.tcp_max_tw_buckets = 360000
net.core.netdev_max_backlog = 2500
vm.min_free_kbytes = 65536
vm.swappiness = 0
net.ipv4.ip_local_port_range = 1024 65535
net.core.somaxconn = 65535
kernel.shmmax=37396480

sysctl -p
sysctl -p /etc/stsctl.conf

ulimit -n 20000000 (20k sockets open)
cat /proc/sys/fs/nr_open (1041576=> 20000000)
root@ubuntu:~# cat /etc/security/limits.conf (mongodb)
?
Limit Soft Limit Hard Limit Units
Max cpu time unlimited unlimited seconds
Max file size unlimited unlimited bytes
Max data size unlimited unlimited bytes
Max stack size 8388608 unlimited bytes
Max core file size 0 unlimited bytes
Max resident set unlimited unlimited bytes
Max processes 1000000 1000000
processes
Max open files 1000000 1000000 files
Max locked memory 65536 65536 bytes
Max address space unlimited unlimited bytes
Max file locks unlimited unlimited locks
Max pending signals 643901 643901 signals
Max msgqueue size 819200 819200 bytes
Max nice priority 0 0
Max realtime priority 0 0
Max realtime timeout unlimited unlimited us
_____________________________
http://www.eweek.com/enterprise-apps/linux-3.13-improves-networking-memory-performance.html
_____________________________
nftables (Linux 3.13+ new packet filtering technology)
   Iptables             nftables 
 typically used for  more robust and
 security, access    easier to use than
 and firewall        iptables while 
  configuration.     offering similar
                     functionality  
                     backward-compatible
                     with iptables rules


Denise Dumas,Platform Engineering @ Red Hat,
"""iptables has always been difficult for customers to use successfully
and we have high hopes that nftables will provide a much more user-friendly experience."""
_________________________________
Networking also gets a boost in Linux 3.13 with a pair of innovations,  including the High-Availability Seamless Redundancy (HSR) standard that  is now supported in Linux, enabling a new approach for failover.
""It [HSR] requires a special network topology where all nodes are connected in a ring (each node having two physical network interfaces),""
 Linux developer Arvid Brodin wrote in his code commit message. ""It is suited for applications that demand high availability and very short reaction time.""

In addition to HSR, Linux 3.13 benefits from the TCP Fast Open specification, which is intended to accelerate the ability of a system 
to open up multiple Transmission Control Protocol (TCP) connections. The technology first landed in the Linux 3.7 kernel  at the end of 2012 and is now enabled by default in the Linux 3.13 release.

""Applications have started to use Fast Open (e.g., Chrome browser has such an optional flag) and the feature has gone through several 
generations of kernels since 3.7 with many real network tests,"" Linux kernel developer Yuchung Cheng wrote in his code commit message. 
""It's time to enable this flag by default for applications to test more conveniently and extensively.""
See more at: http://www.eweek.com/enterprise-apps/linux-3.13-improves-networking-memory-performance.html#sthash.WVlKASt4.dpuf
________________________________
http://lartc.org/ (LInux Advanced Routing and Traffic Control)
________________________________
http://www.linuxjournal.com/content/dnsmasq-pint-sized-super-d%C3%A6mon
DNSMasq: the way it works is simplicity at its finest. First, let's look at its features:
Extremely small memory and CPU footprint: I knew this was the case, because it's the program that runs on Linux-based consumer routers where
memory and CPU are at a premium.

DNS server: DNSMasq approaches DNS in a different way from the traditional BIND dæmon. It doesn't offer the complexity of domain
transfers, master/slave relationships and so on. It does offer extremely simple and highly configurable options that are, in my opinion, far
more useful in a small- to medium-size network. It even does reverse DNS (PTR records) automatically! (More on those details later.)

DHCP server: where the DNS portion of DNSMasq lacks in certain advanced features, the DHCP services offered actually are extremely robust. 
Most routers running firmware like DD-WRT don't offer a Web interface to the advanced features DNSMasq provides, but it rivals and even
surpasses some of the standalone DHCP servers.

TFTP server: working in perfect tandem with the advanced features of DHCP, DNSMasq even offers a built-in TFTP server for things like booting
thin clients or sending configuration files.

A single configuration file: it's possible to use multiple configuration files, and I even recommend it for clarity's sake. In the end, however,
DNSMasq requires you to edit only a single configuration file to manage all of its powerful services. That configuration file also is very well
commented, which makes using it much nicer.

________________________________

High Availability {{{
Sofware.admin.HA  Setting up a high availability nfs with drdb and heartbeat  http://www.howtoforge.com/high_availability_nfs_drbd_heartbeat
    Virtual Router Redundancy Protocol  http://fr.wikipedia.org/wiki/Virtual_Router_Redundancy_Protocol
    DRDB: Networked RAID 1  http://www.drbd.org/
    "The GlusterFS project, a petabyte-scale, networked elastic filesystem.

Gluster Geo-replication GlusterFS Geo-replication provides a continuous, asynchronous, and incremental replication service from one site to another over Local Area Networks (LANs), Wide Area Networks (WANs) and across the Internet. "   http://blog.gluster.com/2011/06/new-release-glusterfs-3-2-1/
}}}  

________________________________
BPF  : Berkeley Packet Filters.
eBPF : Extended Berkeley Packet Filters.
cBPF : Clasic   Berkeley Packet Filters.

http://www.man7.org/linux/man-pages/man2/bpf.2.html
"""  For both cBPF and eBPF programs, the kernel statically
   analyzes the programs before loading them, in order to ensure that
   they cannot harm the running system."""

Related:
   Cilium 1.0.0-rc4 Released:
   Transparently Secure Container Network Connectivity Utilising Linux BPF
   https://www.infoq.com/news/2018/03/cilium-linux-bpf

   Microservices applications tend to be highly dynamic, and this presents both a challenge and an opportunity in terms of securing connectivity between microservices. Modern approaches to overcoming this issue have coalesced around the CNCF-hosted <a href="https://github.com/containernetworking/cni">Container Network Interface (CNI)</a> and the increasingly popular "<a href="https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/">service mesh</a>" technologies, such as <a href="https://www.infoq.com/news/2017/05/istio">Istio</a> and <a href="https://www.infoq.com/news/2018/01/conduit-service-mesh">Conduit</a>. According to the <a href="http://cilium.readthedocs.io/en/latest/intro/">Cilium documentation</a>, traditional Linux network security approaches (such as <a href="https://en.wikipedia.org/wiki/Iptables">iptables</a>) filter on IP address and TCP/UDP ports. However, the highly volatile life cycle of containers and IP addresses cause these approaches to struggle to scale alongside the application&nbsp;as the large number of load balancing tables and access control lists&nbsp;must be updated&nbsp;continually.</p>

<p>Cilium attempts to address the issue with scaling by utilising a (relatively) new technology called <a href="https://en.wikipedia.org/wiki/Berkeley_Packet_Filter">Berkeley Packet Filter (BPF)</a>. BPF is a <a href="https://github.com/cilium/cilium#user-content-what-is-ebpf-and-xdp">Linux kernel bytecode interpreter</a> that was originally introduced to filter network packets, as seen in <a href="https://www.tcpdump.org/tcpdump_man.html">tcpdump</a> and socket filters. It has been extended with additional data structures such as hash tables and arrays as well as additional actions to support packet mangling, forwarding, encapsulation, etc. An in-kernel verifier ensures that BPF programs are safe to run and a JIT compiler converts the bytecode to CPU architecture specific instructions for native execution efficiency. For readers keen to explore BPF in further detail, performance Guru <a href="http://www.brendangregg.com/">Brendan Gregg</a> has written and talked extensively about "<a href="http://www.brendangregg.com/blog/2016-03-05/linux-bpf-superpowers.html">Linux BPF Superpowers</a>".</p>

________________________________
socat
________________________________

________________________________


-->

</html>
