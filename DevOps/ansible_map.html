<!DOCTYPE html>
<html>
   <meta charset="UTF-8">
   <title>Ansible map (v1.0)</title>
<!-- mapview_v1 {{{ -->
<script>
var zoomDivDOM
function doCloseZoom() {
  zoomDivDOM.innerHTML = ''; 
  zoomDivDOM.style.display="none";
}
var zoomDivFW = true; // FW Full Width
var zoomDivFH = true; // FW Full Height 
var zoomDivTop = true; 
var zoomDivLft = true; 

var zoom=0.1
var idxXXXsmallRule=-1;
var idxXXsmallRule =-1;
var idxXsmallRule  =-1;
function onZoomOut(){
  zoom=zoom - 0.05
  document.styleSheets[0]['cssRules'][idxXXXsmallRule].style['font-size']=zoom+'rem';
}
function onZoomIn(){
  zoom=zoom + 0.05
  document.styleSheets[0]['cssRules'][idxXXXsmallRule].style['font-size']=zoom+'rem';
}
function doOpenZoom(e)      { 
  zoomDivDOM.innerHTML = 
     "<span style='font-size:1.0rem; color:blue;'>('Esc' to close)<br/></span>" 
   + this.outerHTML; 
  zoomDivDOM.style.display="block";
  e.stopPropagation();
}

function removeToLeftMarginInPre() {
  // TODO:(0) Not working
  // nodeList = document.querySelectorAll('pre')
  // for (idx in nodeList) { 
  //   var node = nodeList[idx]
  //   var html = node.innerHTML
  //   var pattern = html.match(/^\s*[|]/)
  //   var regEx = new RegExp(pattern, "")
  //   console.log(html)
  //   node.innerHTML = html.replace(regEx,''))
  //    
  // }
}


function onPageLoaded() {
  zoomDivDOM = document.getElementById('zoomDiv')
  document.addEventListener('keyup',function(e) { if (e.code !== "Escape") return; doCloseZoom(); })
  // Change default a.target to blank. Ussually this is bad practice 
  // but this is the exception to the rule
  var nodeList = document.querySelectorAll('a')
  for (idx in nodeList) { 
      if (!nodeList[idx].href) { continue; }
      if (nodeList[idx].href && !nodeList[idx].href.startsWith("http")) continue;
      nodeList[idx].target='_blank'; 
  }
  nodeList = document.querySelectorAll('td')
  for (idx in nodeList) { 
     if (!!! nodeList[idx].addEventListener) continue;
     nodeList[idx].addEventListener('dblclick',doOpenZoom, false)
  }
  nodeList = document.querySelectorAll('*[zoom]')
  for (idx in nodeList) { 
     if (!!! nodeList[idx].addEventListener) continue;
     nodeList[idx].addEventListener('dblclick',doOpenZoom, false)
  }

  removeToLeftMarginInPre();

  for (idx=0; idx<document.styleSheets[0]['cssRules'].length; idx++){
      if( document.styleSheets[0]['cssRules'][idx].selectorText == "[xxxsmall]") {
          idxXXXsmallRule=idx;
      }
      if( document.styleSheets[0]['cssRules'][idx].selectorText == "[xxsmall]") {
          idxXXsmallRule=idx;
      }
      if( document.styleSheets[0]['cssRules'][idx].selectorText == "[xsmall]"  ) {
          idxXsmallRule=idx;
      }
  }
  // Simulate initial dblclick to show help
  var event = new MouseEvent('dblclick', { 'view': window, 'bubbles': true, 'cancelable': true });
  document.getElementById('initialMessage').dispatchEvent(event);
}
</script>
<style { >
*[blue]         { color:blue !important;  }
*[orange]         { color:orange !important; }
*[green]         { color:green !important;  }
*[brown]         { color:brown !important;  }
b { color: #0A9}
*[mono]         { font-family: monospace; white-space: pre; }
pre { background-color:#EEEEEE; outline:1px dotted grey; margin: 0; }
*[cite]         { font-style: italic; }
*[TODO]         { color:red; font-weight: bold; }
*[TODO]:before  { content: "TODO:"; }
*[xxxsmall]{ font-size:0.1rem; }
img[xxxsmall]{ max-width:10rem; }
*[xxsmall] { font-size:0.3rem; }
*[xsmall]  { font-size:0.7rem; }
*[small]   { font-size:0.9rem; }
*[xxbig]  { font-size:1.7em; font-weight: bold; color:#007733;}
*[xbig]  { font-size:1.5em; }
*[hidden]  { display:none; }
ul,ol { margin-left: 1.0em; padding-left: 0rem; }
#zoomDiv [xxxsmall] , #zoomDiv * [xxxsmall], #zoomDiv * * [xxxsmall], #zoomDiv * * * [xxxsmall]{ font-size:1em; } 
#zoomDiv img[xxxsmall] , #zoomDiv * img[xxxsmall], #zoomDiv * * img[xxxsmall], #zoomDiv * * * img[xxxsmall]{ max-width:100%; } 

/* REF: https://stackoverflow.com/questions/4910077/select-all-child-elements-recursively-in-css */
#zoomDiv * [small], #zoomDiv * [xsmall], #zoomDiv * [xxsmall] { font-size:1em; }
#zoomDiv *[small], #zoomDiv *[xsmall], #zoomDiv *[xxsmall] { font-size:1em; }
#zoomDiv * td { font-size:1em; }

body      { font-family:sans-serif; font-size:16px; padding: 0; margin: 0; }
#zoomDiv  { 
   display:none;
   position:fixed; top:0.1%; left:0.1%; width:auto; height:auto;
   max-height: 98%; max-width: 98%; overflow: auto;
   background-color:#FFFFFF; color:#000; border-radius: 0.5rem; border: 4px solid black; font-size: 2rem;
   box-shadow: 5px 5px 30px black;
   padding: 0.5rem;
}

a            { text-decoration:none; font-family:monospace; padding:0.0;}
a[href^="#"]:before /* mark internal anchor */ {  content: ">"; }
a[href^="#"]:after  /* mark internal anchor */ {  content: "<"; }
a:visited { color:blue; }
td { 
   font-size: 0.8rem;
   vertical-align: top;
   outline: 1px solid grey; 
}
td,th               {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col0] ,th[col1]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col2] ,th[col2]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col3] ,th[col3]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col4] ,th[col4]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col5] ,th[col5]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col6] ,th[col6]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col7] ,th[col7]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col8] ,th[col8]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col9] ,th[col9]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col10],th[col10] {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col11],th[col11] {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col12],th[col12] {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
tr[header_delimit] > *{background-color:#000000; color:#FFFFFF; font-size:2em; color: white; }
tr[header_delimit] > td > a{color:inherit; text-decoration: underline; }
div[subtable1] { max-width: 95%; overflow: auto; padding:0; margin: 0;}

table { width:100% border:0; margin: 0;}
</style }>
</head>
<body onLoad='onPageLoaded()'>
<b id='initialMessage' orange>Hint double-click on elements to zoom!!</b>
<div id='zoomDiv'></div>
<div style="position:fixed; right:0.3%; bottom:0; width:auto;">
<b style="font-size:1.5rem" orange><a onclick="onZoomOut()">[-A]</a></b>
<b style="font-size:1.5rem"       >                                 </b>
<b style="font-size:2.0rem" orange><a onclick="onZoomIn ()">[A+]</a></b>
</div>
<!-- mapview_v1 }}} -->

<table { >
<tr {>
  <td col1 colspan=1>
    <b>Ansible</b>
    <ul xxxsmall zoom >
      <li>cofiguration management tool</li>
      <li><pre>ansible-doc "module_name"</pre></li>
      <li>Write some kind of (desired) state description for servers<br/>
          (right packages, conf. files, permissions, running services,...)</li>
      <li>Orchestates deployment (order in which "things" are deployed to different servers)</li>
      <li>Provisioning new VMs to clods like EC2, Azure, Digital Ocean, Google Compute Engine,
          Linode, Rackspace, OVH, and any cloud supporting OpenStack API (OVH, ...)</li>
      <li>Ansible can execute arbitrary shell commands on remote servers,
          but real power comes from the collection of modules it ships with 
      </li>
      <li>Ansible modules are declarative: describe desired state<br/>
          For example invoke the user module like this to ensure there was
          an account named deploy in the web group:
<pre { >
user: name=deploy group=web
</pre }  >
      </li>
      <li>Modules are also idempotent (warrants always same results)</li>
      <li>The primary unit of reuse in the Ansible community is the module.</li>
      <li>Ansible has excellent support for templating, as well as defining
          variables at different scopes.</li>
      <li>Ansible uses the YAML file format and the Jinja2 templating languages</li>

    </ul>
    <br/>
    <b>How Ansible Works</b><br/>
<pre xxxsmall zoom { >
|playbook| 1←→N |Play| 1←→N |Hosts|
                 ↑
                1└──────→N |Task|→|Module|


A play(book) describes :
  - <b>which hosts</b> ("remote servers") to configure
  -and an <b>ordered list of tasks</b> to perform on those hosts.

</pre }>
    <b>important:</b>
    <ul xxxsmall zoom >
      <li>Ansible runs each task in parallel across all hosts.</li>
      <li>Ansible waits until all hosts have completed a task before moving to the next task.</li>
      <li>Ansible runs the tasks in the order that you specify them</li>
      </li>
    </ul>
    <br/>

    <b>"hosts" inventory file</b>
    <ul xxxsmall zoom >
      <li>Each server needs a name that Ansible will use to identify it, either:<br/>
       - hostname of the server<br/>
       - alias + additional arguments indicating how to connect
      </li>
      <li> Defaults to <code>/etc/ansible/hosts</code> </li>
      <li>if "hosts" is marked as executable (+x) it's executed and the output json taken as inventory. This executable script must support the <code>--host=...</code> and <code>--list</code> command line flags</li>
      <li>Ex: .../playbooks/hosts
<pre {>
<span green># development</span>
<span brown># stagin</span>
<span orange># production</span>

[all:vars]
ntp_server=ntp.ubuntu.com

[<span orange>production</span>:vars]
db_primary_host=rhodeisland.example.com
db_primary_port=5432
db_replica_host=virginia.example.com
db_name=widget_production
db_user=widgetuser
db_password=pFmMxcyD;Fc6)6
rabbitmq_host=pennsylvania.example.com
rabbitmq_port=5672


[<span brown>staging</span>:vars]
db_primary_host=quebec.example.com
db_primary_port=5432
db_name=widget_staging
db_user=widgetuser
db_password=L@4Ryz8cRUXedj
rabbitmq_host=quebec.example.com
rabbitmq_port=5672

[<span green>vagrant</span>:vars]
db_primary_host=vagrant3
db_primary_port=5432
db_name=widget_vagrant
db_user=widgetuser
db_password=password
rabbitmq_host=vagrant3
rabbitmq_port=5672

[<span brown>stagin</span>]
<span brown>ontario.example.com</span>
<span brown>quebec.example.com</span>

[<span green>vagrant</span>]
<span green>vagrant1 ansible_host=127.0.0.1 ansible_port=2222</span>
<span green>vagrant2 ansible_host=127.0.0.1 ansible_port=2200</span>
<span green>vagrant3 ansible_host=127.0.0.1 ansible_port=2201</span>

[lb]
<span orange>delaware.example.com</span>

[web]
<span orange>georgia.example.com</span>
<span orange>newhampshire.example.com</span>
<span orange>newjersey.example.com</span>
<span brown>ontario.example.com</span>
<span green>vagrant1</span>

[task]
<span orange>newyork.example.com</span>
<span orange>northcarolina.example.com</span>
<span orange>maryland.example.com</span>
<span brown>ontario.example.com</span>
<span green>vagrant2</span>

[rabbitmq]
<span orange>pennsylvania.example.com</span>
<span brown>quebec.example.com</span>
<span green>vagrant3</span>

[db]
<span orange>rhodeisland.example.com</span>
<span orange>virginia.example.com</span>
<span brown>quebec.example.com</span>
<span green>vagrant3</span>

# group of gruops:
[django:children]
web
task

# ranges
[webgroup2]
web[01:20].example.com
web-[a-t].example.com

</pre }>
        test host file config using something like:
<pre { >
  $ ansible testserver -i hosts -m ping
</pre }>
      </li>
      </li>
    </ul>
      <li>
    <br/>
    <b><code><a href="http://docs.ansible.com/ansible/latest/intro_configuration.html">ansible.cfg</a>:</code></b>

    <br/>
<pre xxxsmall zoom {>
Location order:
$ANSIBLE_CONFIG 
  -> ./ansible.cfg
    -> ~/.ansible.cfg
      -> /etc/ansible/ansible.cfg
Ex:
[defaults]
inventory = hosts
remote_user = vagrant
private_key_file = ~/.ssh/private_key
host_key_checking = False
</pre }
    <br/>
    <b><code>command</code> module</b>
<pre xxxsmall zoom { >
$ ansible testserver -m command -a uptime
$ ansible testserver -a uptime # (command is the default module)

testserver | success | rc=0 >>
17:14:07 up  1:16,  1 user, load average: 0.16, ...
</pre } >
  </td>  
  <td col2>
    <b xbig>Error Handling</b><br/>
    <ul xxxsmall zoom >
      <li>error scenarios has always been a challenge. 
          Historically, Ansible has been error agnostic in the sense 
          that errors and failures may occur on a host.
      </li>
      <li>default behavior is to take a host out of the play
         if a task fails and continue as long as there are hosts
         remaining that haven’t encountered errors.
      </li>
      <li><code orange>serial</code> and <code orange>max_fail_percentage</code> gives some control over when a play has to be declared as failed.
      <li>With the blocks clause as shown in Example 8-27, Ansible advances error handling a bit further and lets us automate recovery and rollback of tasks in case of a failure.
<pre { >
"try-catch-finally"
- hosts: app-servers
  serial: 1
  tasks:
  - name: Take VM out of the load balancer
  - name: Create a VM snapshot before the app upgrade

  - block:
    - name: Upgrade the application
    - name: Run smoke tests

  <b orange>rescue:</b>
    - name: Revert a VM to the snapshot after a failed upgrade

  <b orange>always:</b>
    - name: Re-add webserver to the loadbalancer
    - name: Remove a VM snapshot
</pre } >
      </li>
    </ul>

    <b>Ex: Installing nginx</b>
<pre xxxsmall zoom { >
web-tls.yml
- name: wait in control host for ssh server to be running
  local_action: wait_for port=22 host="{{ inventory_hostname }}"
    search_regex=OpenSSH

- name: Configure nginx
  <b xbig>hosts:</b> webservers
  become: True
  <b xbig>vars:</b>
    <span orange>key_file</span>: /etc/nginx/ssl/nginx.key
    <span green>cert_file</span>: /etc/nginx/ssl/nginx.crt
    <span blue>conf_file</span>: /etc/nginx/sites-available/default
    server_name: localhost
  <b xbig>tasks:</b>
    - name: install nginx
      <b>apt</b>: <b>name</b>=nginx <b>update_cache</b>=yes

    - name: create directories for ssl certificates
      <b>file</b>: <b>path</b>=/etc/nginx/ssl <b>state</b>=directory

    - name: copy TLS key
      <b>copy</b>: <b>src</b>=files/nginx.key <b>dest</b>={{ <span orange>key_file</span> }} owner</b>=root <b>mode</b>=0600
      <b>notify</b>: restart nginx

    - name: copy TLS certificate
      <b>copy</b>: <b>src</b>=files/nginx.crt <b>dest</b>={{ <span green>cert_file</span> }}
      <b>notify</b>: restart nginx

    - name: copy config file
      <b>copy</b>: <b>src</b>=files/nginx.conf<b>.j2</b> <b>dest</b>={{ <span blue>conf_file</span> }}

    - name: enable configuration
      # set attributes of file, symlink or directory
      <b>file</b>: <b>dest</b>=/etc/nginx/sites-enabled/default <b>src</b>={{ <span blue>conf_file</span> }} state=link
    - name: copy index.html
      # template -> new file -> remote host      
      <b>template</b>: <b>src</b>=templates/index.html.j2 <b>dest</b>=/usr/share/nginx/html/index.html
        mode=0644

    - name: show a debug message
      debug: "msg='Example debug message: conf_file {{ <span blue>conf_file</span> }} included!'"

    - name: Example to register new ansible variable
      command: whoami
      register: login
    # (first debug helps to know who to write the second debug)
    - debug: var=login
    - debug: msg="Logged in as user {{ login.stdout }}"

    - name: Example to <b>ignore errors</b>
      command: /opt/myprog
      register: result
      ignore_errors: <b>True</b>
    - debug: var=result

  <b xbig>handlers:</b>
    - name: restart nginx
      <b>service</b>: <b>name</b>=nginx <b>state</b>=restarted
</pre } >

    <br/>
    <b>"Jinja2" templat.ex.</b><br/>
    <code>nginx.conf<b>.j2</b>:</code>
<pre xxxsmall zoom { >
server {
        listen 80 default_server;
        listen [::]:80 default_server ipv6only=on;

        listen 443 ssl;

        root /usr/share/nginx/html;
        index index.html index.htm;

        server_name <b>{{</b> server_name <b>}}</b>;
        ssl_certificate <b>{{</b> cert_file <b>}}</b>;
        ssl_certificate_key <b>{{</b> key_file <b>}}</b>;

        location / {
                try_files $uri $uri/ =404;
        }
}
</pre } >
    <br/>
    <b>Gathering facts</b><br/>
<pre xxxsmall zoom { >
# Using mod. <code orange>setup</code> to gather host facts:
$ ansible -i hosts vagrant1 -m <b orange>setup</b>
vagrant1 | SUCCESS => {
    "<b blue>ansible_facts</b>": {
        "ansible_all_ipv4_addresses": [
            "10.0.2.15"
        ],
        ...
        "ansible_architecture": "x86_64",
        "ansible_date_time": { ...  },
        "ansible_default_ipv4": { ...  },
        "ansible_devices": {
            "sda": { ...
                "size": "40.00 GB",
                "partitions": { "size" : "40.00 GB", ...  },
            } },
        ...
        ("tons" of info about memory, hardware, lsb... )
        }
      }

# <b green>Filtering facts</b>
$ ansible -i hosts vagrant1 -m <b orange>setup</b> -a '<b green>filter=ansible_eth*</b>'
vagrand1 | success >> {
    "<b blue>ansible_facts</b>": {
        "<b green>ansible_eth</b>0": {
            "ipv4": { "address": "10.0.0.01", ...  },
            ...  },
        "<b green>ansible_eth</b>1": {
            "ipv4": { "address": "10.0.0.02", ...  },
            ...  },
    },
    "changed": false
}
</pre } >
    <b>Local (custom) Facts how-to:</b><br/>
    <ol xxxsmall zoom > 
      <li>Place one or more files on in <b brown>/etc/ansible/facts.d</b> at remote host in .ini or JSON format (or executable with JSON output).</li>
     <li>Read them from <code orange>ansible_local</code>:
<pre {> 
<b brown>/etc/ansible/facts.d/</b><b blue>example</b>.fact (@ host)
[<b green>book</b>]
title=Ansible: Up and Running
author=Lorin Hochstein
publisher=O'Reilly Media
</pre }>
    To read in ansible scripts:
<pre {>
- name: print ansible_local
  debug: var=<b orange>ansible_local</b>
- name: print book title
  debug: msg="The title of the book is {{ <b orange>ansible_local</b>.<b blue>example</b>.<b green>book</b>.title }}"
</pre }>
     </li>
    </ol> 
  </td>  
  <td col3>
    <b>Roles</b>
    <ul xxxsmall zoom>
      <li>In Ansible, the role is the primary mechanism for breaking a playbook into multiple files, making them easier to reuse.</li>
      <li>Think of a role as something you assign to one or more hosts (database role, web role, ...).
<pre { >
roles path:
1 playbooks directory
2 /etc/ansible/roles

playbook1-role-example.yml:
===========================
- name : my Task name
  hosts: database
  vars_files:
   - secrets.yml

  <span blue># pre_tasks execute before roles </span>
  <span blue>pre_tasks</span>:
    - name: update the apt cache
      apt: update_cache=yes

  roles:
   - role: <b orange>database</b>
     # next vars override those in (vars|defaults)/main.yml
     database_name: " {{ myProject_ddbb_name }}"
     database_user: " {{ myProject_ddbb_user }}"

  <span blue># post_tasks execute after roles </span>
  <span blue>post_tasks</span>:
    - name: notify Slack
      local_action: &gt;
        slack
        domain=acme.slack.com
        token={{ slack_token }}
        msg="database {{ inventory_hostname }} configured"

  ...
===========================
file layout:
roles/<b orange>database</b>/tasks/main.yml 
roles/<b orange>database</b>/files/
roles/<b orange>database</b>/templates/
roles/<b orange>database</b>/handlers/main.yml
roles/<b orange>database</b>/vars/main.yml     # should NO be overrriden
roles/<b orange>database</b>/defaults/main.yml # can be       overrriden
roles/<b orange>database</b>/meta/main.yml     # dependency info about role
</pre } >
      </li>
      <li>
      <b>include_roles</b>
      Allows us to selectively choose what parts of a role will be included and used, but also where in the play
<pre { >
- name: install php
  # include and run main.yml from php role
  <b orange>include_role:</b>
    name: php
</pre } >
      </li>
    </ul>

    <br/>

    <b>changed_when / failed_when</b>
    <ul xxxsmall zoom>
      <li>Used to handle non idempotent tasks.<br/>
      Example <code>django_manage</code> always returns  changed: False for
      some "external" ddbb commands. <span orange>changed_when</span> is used to give hints to ansible:
<pre { >
- name: initialize the database
  django_manage:
    command: createdb --noinput --nodata
    app_path: "{{ proj_path }}"
    virtualenv: "{{ venv_path }}"
  failed_when: False # &lt; avoid stoping execution
  register: <b green>result</b>
  <span orange>changed_when</span>: <b green>result</b>.out is defined and '"Creating tables" in <b green>result</b>.out'

- debug: var=result

- fail:
</pre }>
    </li>
    </ul>

    <br/>

    <b>(j2) filters</b>
    <code orange>|</code> must be interpreted as the "pipe" (input) to filter, not
   the "or" symbol.
<pre xxxsmall zoom { >
# default if undefined:
- ...
  "HOST": "{{ database_host <b orange>| default('localhost')</b> }}"

# fail after some debuging
- ...
  register: result
  <b orange>ignore_errors: True</b>
  ...
  failed_when: result<b orange>| failed</b>
...
<b orange>failed </b>    True if registered value is a failed    task
<b orange>changed</b>    True if registered value is a changed   task
<b orange>success</b>    True if registered value is a succeeded task
<b orange>skipped</b>    True if registered value is a skipped   task
</pre }>
    <br/>
    <b>path filters</b>
<pre xxxsmall zoom { >
<b orange>basename  </b> 
<b orange>dirname   </b>
<b orange>expanduser</b>  '~' replaced by home dir.
<b orange>realpath  </b>  resolves sym.links
Ej:
  vars:
    homepage: /usr/share/nginx/html/index.html
  tasks:
  - name: copy home page
    copy: &lt; 
      src={{ homepage <b orange>| basename</b> }}
      dest={{ homepage }}
</pre }>
    <br/>
    <b>Custom filters</b>
<pre xxxsmall zoom { >
filter_plugins/surround_by_quotes.py
# From http://stackoverflow.com/a/15515929/742
def surround_by_quote(a_list):
    return ['"%s"' % an_element for an_element in a_list]

class FilterModule(object):
    def filters(self):
        return {'surround_by_quote': surround_by_quote}
</pre }>
    <br/>
    <b>DRY pattern</b><br/>
    to avoid duplicating external declarations in ansible vars use "Lookups".
<pre xxxsmall zoom { >
file     Contents of a file
password Randomly generate a password
pipe     Output of locally executed command
env      Environment variable
template Jinja2 template after evaluation
csvfile  Entry in a .csv file
dnstxt   DNS TXT record
redis_kv Redis key lookup
etcd     etcd key lookup
Ex:
  ...
  vars:
    key_files: {{ lookup('file', '/path/to/ExternalPathConfig.txt') }}
</pre }>
  </td>  
  <td col4>
    <b>Dynamic include</b><br/>
<pre xxxsmall zoom { >
- <b orange>include</b>: Redhat.yml
  <b orange>when</b>: ansible_os_family == 'Redhat'

-<b orange>include</b>: Debian.yml
 <b orange>when</b>: ansible_os_family == 'Debian'
</pre }>
    <br/>
    <b>group patterns</b><br/>
<pre xxxsmall zoom { >
Other patterns:A
All hosts       <b orange>all</b>
All             <b orange>*</b>
Union           dev<b orange>:</b>staging
Intersection    staging<b orange>:&amp;</b>database
Exclusion       dev<b orange>:!</b>queue
Wildcard        <b orange>*</b>.example.com
Range           web<b orange>[5:10]</b>
Regex           <b orange>~web\d+\.example\.(com|org)</b>
</pre }>
  <br/>
  <b>Serialize execution</b> 
<pre xxxsmall zoom { >
- name: serialized execution
  hosts: hostTargetGroup
  # Run first, if it works, runs 30% at a time
  <b orange>serial:
    - 1
    - 30%
  </b>
  tasks:
    ...
</pre }>
    <br/>
    <b>free strategy</b>
    (Don't wait for other hosts)
<pre xxxsmall zoom { >
- hosts: all
  connection: local
  <b orange>strategy: free</b>
    ...
</pre }>
   <br/>
  </td>  
</tr }>
</table } >

</body>
<!--
<span xbig>....</span>
<pre xxxsmall zoom { >
</pre }>
<pre xxxsmall zoom { >
</pre }>
-->
</html>
