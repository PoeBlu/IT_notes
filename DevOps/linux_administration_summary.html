<!DOCTYPE html>
<html>
   <meta charset="UTF-8">
   <title>Linux Administration Summary</title>
<!--
 Q:Note what the attribute { and } do:
 A:Those attributes are ignored by the browser but are helpful to fold/unfold text in some
   editors (Vim, Emacs,...)
-->
<!--
TABLE TEMPLATE
<table { >
<tbody>
<tr {>
  <th colspan=12 header_delimit {   >topic1</th>
</tr }>
<tr {>
  <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td>
</tr }>
<tr {>
  <td col1 colspan=6 >
    <ul>
      <li>
      </li>
    </ul>
  </td>  
  <td col2 colspan=6 >
  </td>  
</tr }>
</table } >
-->

<head>
<script>
var zoomDivDOM
function onZoomDivDoubleClick() { zoomDivDOM.innerHTML = ''; }
var zoomDivFW = true; // FW Full Width
var zoomDivFH = true; // FW Full Height 
var zoomDivTop = true; 
var zoomDivLft = true; 
function onTDDoubleClick()      { zoomDivDOM.innerHTML = 
     "('Esc' to close) Toggle "+
     "<span style='color:blue;' onClick=\"zoomDivFW  = !zoomDivFW ; zoomDivDOM.style.maxWidth  = zoomDivFW  ? '98%' : '30%'\">[Width]</span> " 
   + "<span style='color:blue;' onClick=\"zoomDivFH  = !zoomDivFH ; zoomDivDOM.style.maxHeight = zoomDivFH  ? '98%' : '30%'\">[Height]</span> " 
   + " Toggle " 
   + "<span style='color:blue;' onClick=\"zoomDivLft = !zoomDivLft; zoomDivDOM.style.left      = zoomDivLft ? '1%'  : '69%'\">[Horz]</span> " 
   + "<span style='color:blue;' onClick=\"zoomDivTop = !zoomDivTop; zoomDivDOM.style.top       = zoomDivTop ? '1%'  : '69%'\">[Vert]</span> " 
   + " <br/> " 
   + this.innerHTML; 
}

function removeToLeftMarginInPre() {
  // TODO:(0) Not working
  // nodeList = document.querySelectorAll('pre')
  // for (idx in nodeList) { 
  //   var node = nodeList[idx]
  //   var html = node.innerHTML
  //   var pattern = html.match(/^\s*[|]/)
  //   var regEx = new RegExp(pattern, "")
  //   console.log(html)
  //   node.innerHTML = html.replace(regEx,''))
  //    
  // }
}


function onPageLoaded() {
  zoomDivDOM = document.getElementById('zoomDiv')
  document.addEventListener('keyup',function(e) { if (e.code !== "Escape") return; onZoomDivDoubleClick(); })
  // Change default a.target to blank. Ussually this is bad practice 
  // but this is the exception to the rule
  var nodeList = document.querySelectorAll('a')
  for (idx in nodeList) { 
      if (!nodeList[idx].href) { continue; }
      if (nodeList[idx].href && !nodeList[idx].href.startsWith("http")) continue;
      nodeList[idx].target='_blank'; 
  }
  nodeList = document.querySelectorAll('td')
  for (idx in nodeList) { 
     if (!!! nodeList[idx].addEventListener) continue;
     nodeList[idx].addEventListener('dblclick',onTDDoubleClick, false)
  }
  setTimeout(onZoomDivDoubleClick, 3000);
  removeToLeftMarginInPre();
}
</script>
<style { >
*[mono]         { font-family: monospace; white-space: pre; }
pre { background-color:#EEEEEE; outline:1px dotted grey; margin: 0; }
*[cite]         { font-style: italic; }
*[TODO]         { color:red; font-weight: bold; }
*[TODO]:before  { content: "TODO:"; }
*[xxxsmall]{ font-size:0.1rem; }
img[xxxsmall]{ max-width:10rem; }
* xxsmall] { font-size:0.3rem; }
*[xsmall]  { font-size:0.7rem; }
*[small]   { font-size:0.9rem; }
*[xxbig]  { font-size:1.7em; font-weight: bold; color:#007733;}
*[xbig]  { font-size:1.5em; }
*[hidden]  { display:none; }
ul,ol { margin-left: 1.0em; padding-left: 0rem; }
#zoomDiv [xxxsmall] , #zoomDiv * [xxxsmall], #zoomDiv * * [xxxsmall], #zoomDiv * * * [xxxsmall]{ font-size:1em; } 
#zoomDiv img[xxxsmall] , #zoomDiv * img[xxxsmall], #zoomDiv * * img[xxxsmall], #zoomDiv * * * img[xxxsmall]{ max-width:100%; } 

/* REF: https://stackoverflow.com/questions/4910077/select-all-child-elements-recursively-in-css */
#zoomDiv * [small], #zoomDiv * [xsmall], #zoomDiv * [xxsmall] { font-size:1em; }
#zoomDiv *[small], #zoomDiv *[xsmall], #zoomDiv *[xxsmall] { font-size:1em; }
#zoomDiv * td { font-size:1em; }

body      { font-family:sans-serif; font-size:16px; padding: 0; margin: 0; }
#zoomDiv  { 
   position:fixed; top:1%; left:1%; width:auto; height:auto;
   max-height: 98%; max-width: 98%; overflow: auto;
   background-color:#FFFFFF; color:#000; border-radius: 0.5rem; border: 4px solid black; font-size: 2rem;
   box-shadow: 5px 5px 30px black;
   padding: 0.5rem;
}

a            { text-decoration:none; font-family:monospace; padding:0.1em;}
a[href^="#"]:before /* mark internal anchor */ {  content: ">"; }
a[href^="#"]:after  /* mark internal anchor */ {  content: "<"; }
a:visited { color:blue; }
td { 
   font-size: 0.8rem;
   vertical-align: top;
   outline: 1px solid grey; 
}
td,th               {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col0] ,th[col1]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col2] ,th[col2]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col3] ,th[col3]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col4] ,th[col4]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col5] ,th[col5]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col6] ,th[col6]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col7] ,th[col7]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col8] ,th[col8]  {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col9] ,th[col9]  {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col10],th[col10] {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
td[col11],th[col11] {background-color:#FFFFFF; min-width:8.25%; max-width:8.25%; }
td[col12],th[col12] {background-color:#FAFAFA; min-width:8.25%; max-width:8.25%; }
tr[header_delimit] > *{background-color:#000000; color:#FFFFFF; font-size:2em; color: white; }
tr[header_delimit] > td > a{color:inherit; text-decoration: underline; }
div[subtable1] { max-width: 95%; overflow: auto; padding:0; margin: 0;}

table { width:100% border:0; margin: 0;}
</style }>
</head>
<body onLoad='onPageLoaded()'>
<div id='zoomDiv'>Hint: double-click on cell to zoom!!</div>


<table style='width:100%'{>
<tbody>
<tr {>
  <td col1 colspan=6>
    <span xxbig>BackUps</span> 
    <ul>
      <li><span cite>"""<a xbig href="http://www.bacula.org/">Bacula</a> is a set of Open Source, computer programs that permit to manage backup, recovery, and verification of computer data across a network of computers of different kinds,  offering many advanced storage management features that make it easy to find and recover lost or damaged files.</span>"""
      </li>
      <li><span xbig>Symple remote backups with ssh</span> :
<pre { >
$ tar cjf - myDirToBackup \       # local
  | ssh myUser@myRemoteMachine \  # ssh pipe
  "cd myBackupPath && tar -xjf -" # remote
</pre } >
      </li>
      <li><span xbig>Using <code>rsync --link-dest=</code> for incremental backups:</span><br/>
      --link-dest allows rsync to compare the file copy to an existing directory structure and copy only the changed files (an incremental backup) relative to the stated directory and to use hard links for other files.</span>
<pre { small >
$ rsync -avh --delete \
   --link-dest=/pathToReferenceBackup \
   /pathToDirectoryToBackup_CURRENT_SOURCE  \
   /pathToNewBackup

Backup in /pathToNewBackup will use hardlinks for existing
files in (already existing) /pathToReferenceBackup, creating
just "diff" of the first backup.
</pre } >
      </li>
    </ul>
</td>  
  <td col1 colspan=6>
    <span xxbig>SystemD</span> 
     (<a href="http://freedesktop.org/wiki/Software/systemd/">REF@freedesktop</a>,
      <a href="http://www.tecmint.com/create-new-service-units-in-systemd/">See also</a>)<br/>
<pre {>
"service unit"                  "targets"
- createNew                       unit_collection
- run                             "wants"
- lifespan:daemon|run-once

Check unit_collections:          Check status of a service:
# systemctl --type=service       # systemctl status firewalld.service


# systemctl \
   enable|start|stop|restart|disable \
     firewalld.service

# sudo vim /etc/systemd/system/MyCustomScript.service\
  | [Unit]
  | Description = making network connection up
  | After = network.target
  | [Service]
  | ExecStart = /root/scripts/conup.sh
  | [Install]
  | WantedBy = multi-user.target

<b>
Systemd      |Systemd      |Systemd           | Systemd
Utilities    |Daemons      |Targets           | Core
</b>                                            
$ systemctl  |systemd      | bootmode         | manager
$ journalctl |journald     | basic            | systemd
$ notify     |networkd     | shutdown  
$ analyze    |logind       | reboot    
$ cgls       |user session |
$ cgtop                    | multiuser          
$ loginctl                 | dbus dlog, logind  
$ nspawn                   |                    
                           | graphical
                           | user-session
                           | display service

</pre }>
</td>  
</tr }>
</table } >

<table { >
<tr {>
  <th colspan=12 header_delimit {   >SELinux Mandatory Access Control (MAC)</th>
</tr }>
<tr {>
  <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td> <td> </td>
</tr }>
<tr {>
  <td col1 colspan=6 >
    <span xbig></span><br/>
    <ul>
      <li>Linux Kernel "patch" and utilities to provide MAC into the major subsystems of the kernel</li>
       <li>enforcement of MAC policies that confine user programs and system servers, access to files and network resources.</li>
      <li>It has no concept of a "root" superuser</li>
      <li>SELinux users and roles do not have to be related to the actual system users and roles:<br/>
          For every current user, process, files, sockets, messages, network interfaces and ports, and
          other hardware <span xbig>SELinux assigns a three string context consisting of <code>(username, role, domain)</code>(domain and type are synonims)
      </li>
      <li>as a rule, most of the real users share the same SELinux username, and all access control is managed through the third tag, the domain.
      </li>
      <li>Policies determine under which circumstances a process is allowed into a certain domain</li>
      <li>The command <code>runcon</code> allows for the launching of a process into an explicitly specified context (user, role and domain),
          but SELinux may deny the transition if it is not approved by the policy.
      </li>
      <li>mapping between file-system files and security contexts is called <span xbig>"labeling"</span>.<br/>
          It is defined in policy files and can also be manually adjusted.
      </li>
      <li>The SELinux context for a remote file system can be specified explicitly at mount time.</li>
      <li>Hardware types are quite detailed, for instance, bin_t (all files in the folder /bin) or postgresql_port_t (PostgreSQL port, 5432).</li>
      <li>SELinux adds the <code xbig>-Z  switch</code> to the shell commands ls, ps, and some others, allowing to show security context of the files and processes</li>
      <li>Typical policy rules consist of explicit permissions; <br/>
          <span cite>which domains the user must possess to perform certain actions with the given target (read, execute, or, in case of network port, bind or connect), and so on.</cite>.<br/>
          More complex mappings are also possible, involving roles and security levels.
      </li>
      <li>A typical policy consists of a mapping (labeling) file, a rule file, and an interface file, that define the domain transition. <br/>
          These three files must be compiled together with the SELinux tools to produce a single policy file that can be loaded into the kernel</br>
      </li>
<!--  TODO:
    cached information on access-decisions via the Access Vector Cache (AVC)
-->
      <li TODO><a href="http://blog.siphos.be/2015/07/restricting-even-root-access-to-a-folder/">Restricting event root access to a folder</a></li>
    </ul>
  </td>  
  <td col1 colspan=6 >
    <span xxbig>Workflow</span><br/>
    <ol>
      <li>Policies are normally tested in permissive mode first, where violations are logged but allowed</li>
      <li><code>audit2allow</code> tool can be used later to produce additional rules that extend the policy to
          allow all legitimate activities of the application being confined</li>
    </ol>
    <hr/>
    <span xxbig>Command-line utilities</span><br/>
<pre { >
<a href="http://linuxcommand.org/man_pages/chcon1.html">chcon</a>
<a href="http://linux.die.net/man/8/restorecon">restorecon(8)</a>
<a href="http://linux.die.net/man/8/restorecond">restorecond(8)</a>
<a href="http://linux.die.net/man/1/runcon">runcon(1)</a>
<a href="http://linux.die.net/man/1/secon">secon(1)</a>
<a href="http://linux.die.net/man/8/fixfiles">fixfiles(8): fix file security ctxs</a>
<a href="http://linux.die.net/man/8/setfiles">setfiles(8): set file security ctxs</a>
<a href="http://linux.die.net/man/8/load_policy">load_policy(8) </a>
<a href="http://linux.die.net/man/8/booleans">booleans(8) </a>
<a href="http://linux.die.net/man/8/getsebool">getsebool(8) set bool value</a>
<a href="http://linux.die.net/man/8/setsebool">setsebool(8)</a>
<a href="http://linux.die.net/man/8/togglesebool">togglesebool(8) </a>
$ sudo setenforce 1  # put into enforce mode
$ getenforce         # get status
semodule
postfix-nochroot
check-selinux-installation
semodule_package
checkmodule
selinux-config-enforcing
selinuxenabled
selinux-policy-upgrade
</pre } >
    
    <span xxbig>Troubleshooting</span><br/>
   <a href="http://stackoverflow.com/questions/23851452/cant-resolve-domain-names-in-php-under-apache/24019910#24019910">Problems with Apache and DNS:</a>
<pre { >
# -P => change also boot-time default
$ setsebool -P nis_enabled 0  
$ setsebool -P httpd_can_network_connect 1
</pre } >

<br/>

</td>  

</tr>
<tr>
  <td col2 colspan=12 TODO>
<a href="https://opensource.com/article/18/2/understanding-selinux-labels-container-runtimes">Understanding SELinux labels for container runtimes</a>, <br/>
What happens to a container's MCS label when the container is rebuilt or upgraded?
  </td>  
</tr }>
</table } >
</body>
<!--

____________________________________________
____________________________________________
____________________________________________
yum grouplist | grep Dev
...
Development Tools
...
yum groupinfo "Development Tools"
...
sudo yum groupinstall "Development Tools"

____________________________________________
APT {{{
Installing from testing/unstable:
/etc/apt/sources.list

deb http://ftp.us.debian.org/debian squeeze main
deb http://ftp.us.debian.org/debian testing main contrib non-free # <- add this line
deb http://ftp.us.debian.org/debian unstable main contrib non-free # <- add this line

$ sudo apt-get update
$ sudo apt-get install gcc/testing
______________
Show package info:
$ apt-cache show gcc
______________

apt-get aptitude
dselect
dpkg (state)
apt-cache
______________
}}}
____________________________________________
http://linuxcommand.org/man_pages/
http://linux.die.net
Command-line Tools  Summary https://linux.die.net/Linux-CLI/ Command-line Tools  Summary
<
______________________
TODO: HHRR
Ioannis Koustoudis: LFCS­Linux sysadmin from Kavala, Greece. He works for the ministry of education and supports almost 200 school units in their infrastructure. If he is not in front of a computer screen, he plays music (he is a multi­-instrumentalist) or take care of his two lovely kids.

-->


</html>
